/**
 * @file: Diary.md
 * @description: Технический дневник проекта Neurohod
 * @dependencies: Project.md, Tasktracker.md, changelog.md, qa.md
 * @created: 2025-08-19
 */

## 2025-08-19
### Наблюдения
- Созданы конфиги: `config/content/posts.schema.yaml`, `config/content/posts.example.yaml`, `config/app.yaml`.
- Старт проекта. Определена целевая архитектура бота и интеграций.
- Взаимодействие только через inline-кнопки, тексты постов поступят позже.
- Зафиксированы требования к оплате и два варианта платёжного потока (Telegram Payments и hosted checkout).
- Зафиксированы параметры оплаты: 8700 RUB, гео — РФ.
- Контакт поддержки — личка @SlavaNikitin.

### Решения
- Выбран стек Node.js + TypeScript, фреймворк бота grammY (предложение).
- Хранение состояний в PostgreSQL, кеш/рейткеп в Redis. Платежи — Telegram Payments/альтернатива.
- Добавлен раздел «Платежи: требования и платёжный поток» в `Project.md`.
- Обновлены `Project.md`, `Tasktracker.md`, `qa.md` для отражения параметров.
- В `Project.md` уточнён раздел конфигурации; в `Tasktracker.md` добавлены подзадачи по валидации и загрузке конфигов.

### Проблемы
- Не выбран конкретный платежный провайдер (нужны бизнес-данные).
- Тексты постов 1–6 пока отсутствуют; затачиваем под конфиги.
- Не определены провайдер, валюта/сумма, необходимость фискализации; вынесено в вопросы.
- Уточнены параметры платежей: провайдер YooKassa, валюта RUB, разовый платёж без автопродления, чеки не требуются.
- Требуется реализация валидатора конфигов и загрузчика в коде приложения.

### Решения
- Приоритетный поток — Telegram Payments + YooKassa; hosted checkout остаётся резервом.

### Проблемы
- Не определены сумма и гео; требуется уточнение.

### Наблюдения
- Планируем реализацию каркаса приложения на Node.js 20 + TypeScript, grammY (бот), Express (webhook), Ajv (валидация), YAML (парсинг), pino (лог).

### Решения
- Режим запуска: webhook при наличии `TELEGRAM_WEBHOOK_URL`, иначе long polling для dev.

### Проблемы
- Нет

### Наблюдения
- Dev-режим: long polling при отсутствии `TELEGRAM_WEBHOOK_URL`.

### Решения
- Интеграцию YooKassa переносим на заключительный этап.

### Проблемы
- Нет

## 2025-08-20
### Наблюдения
- Добавлена 4-я кнопка "Хочу изучать нейросети" к первому посту
- Кнопка позволяет пользователям сразу перейти к продающему посту (post_6)
- Реализован новый тип кнопки "jump" для навигации между постами
- Удалена кнопка "Зарегистрироваться на вебинар" из 6-го поста по запросу пользователя
- Изменен текст кнопки оплаты в 6-м посте на "Приступить к обучению!"

### Решения
- Добавлен тип PostButtonJump в типы конфигурации
- Обновлена схема posts.schema.yaml для поддержки jumpButton
- Добавлена обработка jump кнопок в bot.ts
- Обновлена конфигурация первого поста
- Удалена кнопка вебинара из 6-го поста, оставлена только кнопка оплаты
- Изменен текст кнопки оплаты на более призывной: "Приступить к обучению!"
- Подготовлен проект к продакшен деплою с улучшенным мониторингом
- Создано руководство по развертыванию на бесплатных платформах
- Добавлен graceful shutdown и улучшен health check

### Проблемы
- Нет

## [2025-01-27] - Понимание работы локального бота

### Наблюдения:
- Бот работает в режиме long polling при локальном запуске
- При остановке процесса (Ctrl+C, закрытие терминала) бот перестает отвечать
- Это нормальное поведение для локальной разработки
- Для постоянной работы нужен деплой на сервер

### Решения:
- Локальный бот запускается командой `npm run dev`
- Проверка работоспособности через `curl http://localhost:3000/healthz`
- Для продакшена планируется деплой на Koyeb

### Проблемы:
- Нет - это ожидаемое поведение


