/**
 * @file: Tasktracker.md
 * @description: Трекер задач проекта Neurohod
 * @dependencies: Project.md, Diary.md, changelog.md, qa.md
 * @created: 2025-08-19
 */

## Задача: Инициализация проекта и документации
- **Статус**: Завершена
- **Приоритет**: Высокий
- **Описание**: Создание начальной структуры `docs`, базовой архитектурной документации и трекера задач.
- **Шаги выполнения**:
  - [x] Создать папку `docs`
  - [x] Заполнить `Project.md`
  - [x] Создать `Tasktracker.md`
  - [x] Создать `Diary.md`
  - [x] Создать `qa.md`
  - [x] Создать `changelog.md`
  - [x] Создать `/.cursorrules`
- **Зависимости**: нет

## Задача: Архитектура Telegram-бота
- **Статус**: Не начата
- **Приоритет**: Критический
- **Описание**: Спроектировать компоненты бота, сценарии кнопок, хранилище состояния, платежный поток.
- **Шаги выполнения**:
  - [ ] Описать сценарии постов 1–5
  - [ ] Описать сценарий поста 6 (оплата)
  - [ ] Выбор библиотеки (grammY/Telegraf) и подхода (webhook)
  - [ ] Спроектировать модели данных
  - [ ] Спроектировать конфиги контента
- **Зависимости**: `Project.md`

## Задача: Платежная интеграция
- **Статус**: Запланирована
- **Приоритет**: Критический
- **Описание**: Интегрировать Telegram Payments с провайдером YooKassa. Реализовать на заключительном этапе.
- **Шаги выполнения**:
  - [x] Сформировать и зафиксировать требования к оплате и платёжный поток в `Project.md`
  - [x] Выбрать провайдера: YooKassa
  - [x] Уточнить валюту: RUB
  - [x] Уточнить сумму: 8700 RUB
  - [x] Уточнить гео: РФ
  - [x] Уточнить фискализацию: не требуется (чеки не формируются)
  - [x] Политика возвратов: окно 14 дней, без частичных; канал поддержка; сроки 3/10 дней (зафиксировано)
  - [x] Инвойс: «NeuroHod — твой проводник в мир ИИ.» (зафиксировано)
  - [ ] Показ ссылки на политику возвратов в посте 6 и в процессе оплаты
  - [ ] Реализовать создание инвойсов/заказов
  - [ ] Обработать статусы/вебхуки (идемпотентность, подписи)
  - [ ] Возвраты через YooKassa API
- **Зависимости**: Архитектура бота

## Задача: Аналитика и события
- **Статус**: В процессе
- **Приоритет**: Высокий
- **Описание**: Событийная аналитика и метрики конверсий.
- **Шаги выполнения**:
  - [x] Трекинг кликов всех кнопок с привязкой к пользователю (post_id, button_action)
  - [x] Google Sheets интеграция для аналитики
  - [x] Структура таблицы: никнейм, действия по постам 1-6, дата первого захода
  - [ ] Построение воронки post1→…→post6→invoice→paid (в БД/дашборде)
  - [ ] Метрики и алерты по оплатам (основная метрика — количество оплат)
  - [ ] Экспорт метрик в Prometheus/дашборд
- **Зависимости**: Каркас приложения, БД

## Задача: Инфраструктура и деплой
- **Статус**: Не начата
- **Приоритет**: Высокий
- **Описание**: Docker, окружения, мониторинг, CI/CD.
- **Шаги выполнения**:
  - [ ] Dockerfile и docker-compose
  - [ ] Конфигурация окружений и секретов
  - [ ] Настройка `/metrics`, `/healthz`
  - [ ] CI: линт, тесты, сборка
- **Зависимости**: Архитектура

## Задача: Контент и конфигурация
- **Статус**: В процессе
- **Приоритет**: Высокий
- **Описание**: Внешние конфиги постов, тексты и ссылки.
- **Шаги выполнения**:
  - [x] Схема для `posts.schema.yaml`
  - [x] Пример `posts.example.yaml`
  - [x] Общий конфиг `app.yaml`
  - [ ] Валидатор конфигов (JSON Schema)
  - [ ] Загрузка конфигов в приложение
  - [ ] Заглушки текстов 1–6
  - [ ] Интеграция картинок и ссылок
  - [x] Контакт поддержки: ссылка на личку @ArthurMacArthur (https://t.me/ArthurMacArthur)
  - [x] Добавлена 4-я кнопка "Хочу изучать нейросети" к первому посту с переходом к post_6
  - [x] Удалена кнопка "Зарегистрироваться на вебинар" из 6-го поста
  - [x] Изменен текст кнопки оплаты в 6-м посте на "Приступить к обучению!"
- **Зависимости**: Тексты от заказчика

## Задача: Инициализация каркаса приложения
- **Статус**: В процессе
- **Приоритет**: Высокий
- **Описание**: Создать минимальный рабочий каркас (Node.js + TS + grammY + Express), вебхук, загрузка конфигов, валидация.
- **Шаги выполнения**:
  - [x] `package.json`, `tsconfig.json`, `.env.example`
  - [x] `src/index.ts` (вход), `src/http/server.ts` (сервер), `src/bot/bot.ts` (бот)
  - [x] Загрузка и валидация конфигов (`src/services/config/loadConfig.ts`, Ajv)
  - [x] Эндпоинты `/telegram/webhook`, `/healthz`, `/metrics`
  - [x] Dockerfile и `.dockerignore`
  - [ ] Dev запуск: проверить long polling
- **Зависимости**: Конфиги созданы

## Задача: Качество, безопасность, производительность
- **Статус**: Не начата
- **Приоритет**: Средний
- **Описание**: Рейткеп, логирование, метрики, тестирование.
- **Шаги выполнения**:
  - [ ] Рейткеп (Redis)
  - [ ] Логирование и трассировка
  - [ ] Нагрузочные тесты
  - [ ] Оповещения
- **Зависимости**: Инфраструктура

## Задача: Миграция на Koyeb
- **Статус**: В процессе
- **Описание**: Перенос всего проекта с текущей платформы на Koyeb для улучшения производительности и масштабируемости
- **Шаги выполнения**:
  - [x] Регистрация на Koyeb
  - [x] Создание пустого репозитория на GitHub
  - [x] Подготовка проекта к деплою
  - [ ] Настройка переменных окружения
  - [ ] Тестирование деплоя
  - [ ] Настройка webhook'ов
  - [ ] Проверка работоспособности
  - [ ] Документирование процесса
- **Зависимости**: Требуется доступ к Google Sheets API и Telegram Bot Token


